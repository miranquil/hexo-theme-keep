<% const { client_id, client_secret, repository, github_id, github_admins } = theme.comment.gitalk %>

<% if(
        theme.comment.use === 'gitalk'
        && client_id
        && client_secret
        && github_id
        && repository
) { %>
    <div id="gitalk-container"></div>
    <script <%= theme.pjax.enable === true ? 'data-pjax' : '' %>
            src="//cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js"></script>
    <script <%= theme.pjax.enable === true ? 'data-pjax' : '' %>>

      function loadGitalk() {
        let __gitalk__pathname = decodeURI(location.pathname);
        const __gitalk__pathnameLength = __gitalk__pathname.length;
        const __gitalk__pathnameMaxLength = 50;
        if (__gitalk__pathnameLength > __gitalk__pathnameMaxLength) {
          __gitalk__pathname = __gitalk__pathname.substring(0, __gitalk__pathnameMaxLength - 3) + '...';
        }

        try {

          Gitalk && new Gitalk({
            clientID: '<%= client_id %>',
            clientSecret: '<%= client_secret %>',
            repo: '<%= repository %>',
            owner: '<%= github_id %>',
            admin: '<%= github_admins || [github_id] %>',
            id: __gitalk__pathname,
            language: '<%= config.language %>'
          }).render('gitalk-container');

        } catch (e) {
          window.Gitalk = null;
        }
      }

      if ('<%= theme.pjax.enable %>') {
        const loadGitalkTimeout = setTimeout(() => {
          loadGitalk();
          clearTimeout(loadGitalkTimeout);
        }, 1000);
      } else {
        window.addEventListener('DOMContentLoaded', loadGitalk);
      }
    </script>
<% } %>
